## Overview

This project has been implemented to design an IP Timer/PWM module. This IP operates within a 16-bit microprocessor architecture with a 22-bit address space, while the internal registers and values are 32-bit wide.
The main role of the timer is to provide precise time measurement and event scheduling within the system. It allows the processor to generate periodic interrupts, measure time intervals, and manage delays required for real-time operations.
The PWM module generates a configurable pulse-width modulated signal based on parameters provided by the processor. The processor controls the activation, duty cycle, and frequency, enabling accurate control of power, speed, or brightness in external devices such as motors or LEDs.

## Specification

The schematic illustrates the external connectivity of the Timer/PWM IP, highlighting how the processor communicates with our circuit. 

![First Photo](

The following table summarizes all input and output signals, as well as the common variables exchanged between the IP and the processor. 

| **Signal**	| **Direction**	        | **Description**                                                                       |
|-------------|-----------------------|---------------------------------------------------------------------------------------|
| Dbus	      |  Bidirectional	      |  16-bit data bus, corresponding to the processor data bus                             |
| Addr	      |  Input	              |  23-bit address bus, corresponding to the processor address bus                       |
| nAS	        |  Input	              |  Address Strobe signal, validates the address on the address bus                      |
| RnW	        |  Input	              |  Read Not Write signal, selects read or write operation                               |
|nWAIT	      |  Input	              |  Signal allowing the insertion of wait states (not used in this peripheral)           |
| nRST	      |  Input	              |  Active-low reset signal for circuit initialization                                   |
| CLK	        |  Input	              |  System clock signal                                                                  |
| nBE	        |  Input	              |  Byte Enable signals, defining the byte ordering on the data bus                      |
| nCS	        |  Input	              |  Chip Select signal for the Timer/PWM peripheral                                      |
| Gate	      |  Input	              |  Control signal used for Timer operation. Itâ€™s a user input                           |
| Timer_value |  Output	              |  Current value of the Timer                                                           |
| PWM	        |  Output	              |  PWM output signal                                                                    |
| nIT	        |  Output	              |  Interrupt signal generated by the Timer or the PWM                                   |


The timer supports multiple modes of operation:

1.	A disabled mode where the timer is inactive
2.	retriggerable modes where the counting cycle automatically restarts either: 
  a.	internally
  b.	based on an external Gate signal
3.	A non-retriggerable mode in which the counting stops once the maximum value is reached
4.	A clock divider is available to scale the internal clock
5.	A counter driven by the internal clock when the Gate signal is active

The generation of an interrupt upon reaching the maximum count value can be enabled or disabled by the processor. The processor can configure the initial value of the timer and read the current timer value at any time.
The PWM unit allows the processor to define the duty cycle and select the clock source, either external or derived from the timer output. The PWM output can be enabled or disabled by software.

## Architecture

Our circuit *Timer_PWM_IP* will be decomposed into two main parts. 
The first one represents the core part of the circuit. This core manages the mode of functionality of the timer and contain the necessary counter. It initializes the *Timer_value* and finally provide the PWM signal, based on the data of the processor. The inputs and outputs of this core are :

- Init_TO: initial value of the timer
- Timer_value: current value of the timer
- Gate: a user input
- Config: this variable is composed into 3 parts: 
  - Mode: to specify on which mode for the timer we are
  - Max: to specify the maximum value of the counter
  - Start: to indicate the beginning of the counting operation 
- RC_PWM: this variable is also composed into 3 parts:
  - RC: the duty cycle of the PWM signal output
  - Tmax : the period of the signal
  - S_Hor: the internal clock of the PWM (This clock can be different from the original clock when the timer is in the devider mode)
- Validation_PWM: to enable the generation of the PWM signal
- Signal_PWM: the PWM output signal
- CLK: to synchronize our circuit
- IT: to activate the interruption routine
  

| **Relation Name**       | **Direction**      | **Nature**      | **Type Name**        | **Type Description**                                                        |
|-------------------------|--------------------|-----------------|----------------------|-----------------------------------------------------------------------------|
| Init_TO		              | Input              | Permanent	     | DefValue	            | 32-bit data bus (Array [0..31] of DefBit)                                   |
| Validation_PWM	        | Input	             | Permanent	     | DefBit	              | PWM enable control (Active, Inactive)                                       |
| Config	                | Input	             | Permanent	     | Defdata	            | Configuration structure including: Mode ; IT_Activation ; Max ; Start       |
| RC_PWM	                | Input	             | Permanent	     | Defdata	            | PWM configuration including: RC: DefRC ; Tmax: DefTmax ; S_Hor: DefBit      |
| Gate	                  | Input	             | Permanent	     | DefBit	              | Timer gate control (Active, Inactive)                                       |
| Clk	                    | Input	             | Event-driven	   | DefBit	              | Clock signal (Active, Inactive)                                             |
| Signal_PWM	            | Output	           | Permanent	     | DefBit	              | PWM output signal (Active, Inactive)                                        |
| Timer_value	            | Output	           | Permanent	     | DefValue	            | 32-bit timer value (Array [0..31] of DefBit)                                |
| IT	                    | Output	           | Event-driven	   | DefBit	              | Timer interrupt signal (Active, Inactive)                                   |


The second one consists to an interface between the microprocessor and the core. This interface let our circuit convert the input/output of the microprocessor to the input/output that we need for our circuit.  In simple word, he assures that the inputs described in the last table, have been written and organized by the processor, so he convert the value contain inside data bus into some useful values for the inputs of our core circuit. 
The architecture of the IP is described in the figure below:

![second photo](

The source code of this architecture is located in the directory *Vivado_Project/Timer_IP_Design/sources_1*. This directory contains all the blocks presented in the previous block diagram, each implemented in VHDL, and contain also the file *Timer_PWM_IP.v*. This Verilog file is responsible for interconnecting the different blocks and forming the complete Timer IP architecture. The directory also includes a testbench used to validate the functionality of the IP and a top-level file that connects the testbench to the Timer IP.

Although the current implementation fulfills the required functionality, the code can be further optimized and extended to support additional processor signals and interfaces. These improvements were not implemented due to time constraints.



